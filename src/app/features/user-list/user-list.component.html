<!-- Add New User Button -->
<div class="mb-4 flex flex-wrap items-center justify-between gap-2">
  <button
    (click)="triggerPopup()"
    class="min-w-[120px] rounded bg-blue-600 px-4 py-2 text-white hover:bg-blue-700"
  >
    Add New User
  </button>

  <!-- Actions & Search -->
  <div class="flex flex-1 flex-wrap items-center gap-2">
    <button
      (click)="selectAllUsers()"
      class="min-w-[90px] rounded border bg-gray-200 px-3 py-1"
    >
      Select All
    </button>
    <button
      class="min-w-[130px] rounded bg-red-600 px-4 py-2 text-white"
      (click)="openBulkDeletionPopup()"
      [disabled]="selectedUsers.size === 0"
    >
      Delete Selected
    </button>
    <button
      class="min-w-[130px] rounded bg-yellow-500 px-4 py-2 text-white"
      (click)="blockInBulk(true)"
      [disabled]="selectedUsers.size === 0"
    >
      Block Selected
    </button>
    <button
      class="min-w-[130px] rounded bg-green-600 px-4 py-2 text-white"
      (click)="blockInBulk(false)"
      [disabled]="selectedUsers.size === 0"
    >
      Unblock Selected
    </button>
    <button
      (click)="addRandomUsers()"
      class="min-w-[130px] rounded bg-blue-600 px-4 py-2 text-white"
    >
      Add 1 Random User
    </button>
    <input
      type="text"
      placeholder="Search by name or email"
      class="min-w-[200px] flex-1 rounded border px-3 py-2"
      [value]="searchText()"
      (input)="searchText.set($any($event.target).value)"
    />
  </div>
</div>

<!-- Filters + Sorting -->
<div class="mb-4 flex flex-wrap items-center justify-between gap-2">
  <!-- Filters -->
  <div class="flex flex-wrap gap-2">
    <button
      (click)="statusFilter.set('all')"
      [class.bg-blue-500]="statusFilter() === 'all'"
      [class.text-white]="statusFilter() === 'all'"
      class="btn min-w-[70px] rounded border px-3 py-1"
    >
      All
    </button>
    <button
      (click)="statusFilter.set('vip')"
      [class.bg-blue-500]="statusFilter() === 'vip'"
      [class.text-white]="statusFilter() === 'vip'"
      class="btn min-w-[70px] rounded border px-3 py-1"
    >
      VIP
    </button>
    <button
      (click)="statusFilter.set('active')"
      [class.bg-blue-500]="statusFilter() === 'active'"
      [class.text-white]="statusFilter() === 'active'"
      class="btn min-w-[80px] rounded border px-3 py-1"
    >
      Active
    </button>
    <button
      (click)="statusFilter.set('blocked')"
      [class.bg-blue-500]="statusFilter() === 'blocked'"
      [class.text-white]="statusFilter() === 'blocked'"
      class="btn min-w-[80px] rounded border px-3 py-1"
    >
      Blocked
    </button>
    <button
      (click)="statusFilter.set('inactive')"
      [class.bg-blue-500]="statusFilter() === 'inactive'"
      [class.text-white]="statusFilter() === 'inactive'"
      class="btn min-w-[80px] rounded border px-3 py-1"
    >
      Inactive
    </button>
  </div>

  <!-- Sorting -->
  <button
    (click)="toggleSortDirection()"
    class="flex min-w-[140px] items-center gap-2 rounded border border-gray-400 bg-purple-600 px-4 py-2 font-semibold text-white shadow transition hover:bg-purple-700"
  >
    Sorting:
    <span class="flex items-center gap-1">
      @if (sortAscending()) {
        Ascending
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="inline-block h-4 w-4"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M5 15l7-7 7 7"
          />
        </svg>
      } @else {
        Descending
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="inline-block h-4 w-4"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M19 9l-7 7-7-7"
          />
        </svg>
      }
    </span>
  </button>
</div>

<!-- User Cards -->
<div class="flex flex-col gap-4">
  @for (user of paginatedUsers(); track trackByUserId($index, user)) {
    <div
      class="grid items-center gap-4 rounded-lg border p-4 shadow-sm transition hover:shadow-md md:grid-cols-[50px_60px_60px_1fr_120px_120px_100px]"
      [ngClass]="{ 'bg-red-50': user.blocked, 'bg-white': !user.blocked }"
    >
      <!-- Checkbox -->
      <div class="flex justify-start md:justify-center">
        <input
          type="checkbox"
          [checked]="isUserSelected(user)"
          (change)="toggleUserSelection(user)"
          class="h-3 w-3 md:h-5 md:w-5"
        />
      </div>

      <!-- ID -->
      <div class="hidden text-center font-mono md:block">
        <span
          [ngClass]="{
            'bg-gray-200': user.blocked,
            'bg-gray-100': !user.blocked,
          }"
          class="rounded-2xl bg-gray-100 px-3 py-1 text-gray-600 shadow-sm"
          >#{{ user.userId }}</span
        >
      </div>

      <!-- Avatar -->
      <div class="flex items-center justify-center">
        <div
          class="h-12 w-12 overflow-hidden rounded-full border-3"
          [ngClass]="{
            'border-green-500': user.active,
            'border-red-500': !user.active,
          }"
        >
          <img
            src="{{ user.picture }}"
            alt="avatar"
            class="h-full w-full object-cover"
          />
        </div>
      </div>

      <!-- Username + Email -->
      <div class="flex flex-col justify-center truncate">
        <span
          class="flex items-center justify-start gap-3 truncate font-semibold"
          >{{ user.username }}

          @if (user.blocked) {
            <app-lock-icon></app-lock-icon>
          }
        </span>

        <span class="truncate text-sm break-words text-gray-500">{{
          user.email
        }}</span>
      </div>

      <!-- Status / VIP -->
      <div class="text-center">
        <span
          [ngClass]="{
            'bg-green-100 px-4.5 text-green-700': user.active,
            'bg-gray-200 px-3 text-gray-700': !user.active,
          }"
          class="rounded-full py-1 shadow-sm"
        >
          {{ user.active ? '  Active' : 'Inactive' }}
        </span>
      </div>
      <div class="text-center">
        <span
          [ngClass]="{
            'bg-yellow-100 px-7 text-yellow-700': user.vip,
            'bg-purple-100 px-3 text-purple-700': !user.vip,
          }"
          class="rounded-full py-1 shadow-sm"
          >{{ user.vip ? 'VIP' : 'Non-VIP' }}</span
        >
      </div>

      <!-- Actions -->
      <div class="flex flex-col items-end gap-1">
        <button
          class="w-[80px] rounded border bg-gray-200 px-2 py-1 text-center"
          (click)="toggleBlocked(user)"
        >
          {{ user.blocked ? 'Unblock' : 'Block' }}
        </button>
        <button
          class="w-[80px] rounded border bg-red-600 px-2 py-1 text-white"
          (click)="deleteUserPopUp(user)"
        >
          Delete
        </button>
      </div>
    </div>
  }
</div>

<!-- Pagination -->
@if (visibleUsers().length > 0) {
  <div class="mt-4 flex flex-wrap items-center justify-center gap-2">
    <button
      (click)="prevPage()"
      [disabled]="currentPage() === 1"
      class="min-w-[50px] rounded border bg-gray-200 px-3 py-1"
    >
      Prev
    </button>

    @for (
      page of [].constructor(totalPages());
      track pageIndex;
      let pageIndex = $index
    ) {
      <button
        (click)="goToPage(pageIndex + 1)"
        [class.bg-blue-500]="currentPage() === pageIndex + 1"
        class="min-w-[40px] rounded border px-3 py-1"
      >
        {{ pageIndex + 1 }}
      </button>
    }

    <button
      (click)="nextPage()"
      [disabled]="currentPage() === totalPages()"
      class="min-w-[50px] rounded border bg-gray-200 px-3 py-1"
    >
      Next
    </button>
  </div>
}
